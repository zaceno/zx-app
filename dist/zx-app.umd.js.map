{"version":3,"file":"zx-app.umd.js","sources":["../node_modules/picodom/src/h.js","../node_modules/picodom/src/patch.js","../src/state.js","../src/keygen.js","../src/tags.js","../src/sub.js","../src/run.js"],"sourcesContent":["var i\nvar stack = []\n\nexport function h(type, props) {\n  var node\n  var children = []\n\n  for (i = arguments.length; i-- > 2; ) {\n    stack.push(arguments[i])\n  }\n\n  while (stack.length) {\n    if (Array.isArray((node = stack.pop()))) {\n      for (i = node.length; i--; ) {\n        stack.push(node[i])\n      }\n    } else if (node != null && node !== true && node !== false) {\n      children.push(typeof node === \"number\" ? (node = node + \"\") : node)\n    }\n  }\n\n  return typeof type === \"string\"\n    ? { type: type, props: props || {}, children: children }\n    : type(props || {}, children)\n}\n","import { h } from \"./h\"\n\nvar callbacks = []\n\nexport function patch(oldNode, node, container, cb) {\n  var element = patchElement(\n    container || (container = document.body),\n    container.children[0],\n    oldNode,\n    node\n  )\n\n  while ((cb = callbacks.pop())) cb()\n\n  return element\n}\n\nfunction merge(target, source) {\n  var result = {}\n\n  for (var i in target) {\n    result[i] = target[i]\n  }\n  for (var i in source) {\n    result[i] = source[i]\n  }\n\n  return result\n}\n\nfunction createElement(node, isSVG) {\n  if (typeof node === \"string\") {\n    var element = document.createTextNode(node)\n  } else {\n    var element = (isSVG = isSVG || node.type === \"svg\")\n      ? document.createElementNS(\"http://www.w3.org/2000/svg\", node.type)\n      : document.createElement(node.type)\n\n    if (node.props && node.props.oncreate) {\n      callbacks.push(function() {\n        node.props.oncreate(element)\n      })\n    }\n\n    for (var i = 0; i < node.children.length; i++) {\n      element.appendChild(createElement(node.children[i], isSVG))\n    }\n\n    for (var i in node.props) {\n      setElementProp(element, i, node.props[i])\n    }\n  }\n  return element\n}\n\nfunction setElementProp(element, name, value, oldValue) {\n  if (name === \"key\") {\n  } else if (name === \"style\") {\n    for (var name in merge(oldValue, (value = value || {}))) {\n      element.style[name] = value[name] || \"\"\n    }\n  } else {\n    try {\n      element[name] = value\n    } catch (_) {}\n\n    if (typeof value !== \"function\") {\n      if (value) {\n        element.setAttribute(name, value)\n      } else {\n        element.removeAttribute(name)\n      }\n    }\n  }\n}\n\nfunction updateElement(element, oldProps, props) {\n  for (var i in merge(oldProps, props)) {\n    var value = props[i]\n    var oldValue = i === \"value\" || i === \"checked\" ? element[i] : oldProps[i]\n\n    if (value !== oldValue) {\n      setElementProp(element, i, value, oldValue)\n    }\n  }\n\n  if (props && props.onupdate) {\n    callbacks.push(function() {\n      props.onupdate(element, oldProps)\n    })\n  }\n}\n\nfunction removeElement(parent, element, props) {\n  if (\n    props &&\n    props.onremove &&\n    typeof (props = props.onremove(element)) === \"function\"\n  ) {\n    props(remove)\n  } else {\n    remove()\n  }\n\n  function remove() {\n    parent.removeChild(element)\n  }\n}\n\nfunction getKey(node) {\n  if (node && node.props) {\n    return node.props.key\n  }\n}\n\nfunction patchElement(parent, element, oldNode, node, isSVG, nextSibling) {\n  if (oldNode == null) {\n    element = parent.insertBefore(createElement(node, isSVG), element)\n  } else if (node.type != null && node.type === oldNode.type) {\n    updateElement(element, oldNode.props, node.props)\n\n    isSVG = isSVG || node.type === \"svg\"\n\n    var len = node.children.length\n    var oldLen = oldNode.children.length\n    var oldKeyed = {}\n    var oldElements = []\n    var keyed = {}\n\n    for (var i = 0; i < oldLen; i++) {\n      var oldElement = (oldElements[i] = element.childNodes[i])\n      var oldChild = oldNode.children[i]\n      var oldKey = getKey(oldChild)\n\n      if (null != oldKey) {\n        oldKeyed[oldKey] = [oldElement, oldChild]\n      }\n    }\n\n    var i = 0\n    var j = 0\n\n    while (j < len) {\n      var oldElement = oldElements[i]\n      var oldChild = oldNode.children[i]\n      var newChild = node.children[j]\n\n      var oldKey = getKey(oldChild)\n      if (keyed[oldKey]) {\n        i++\n        continue\n      }\n\n      var newKey = getKey(newChild)\n\n      var keyedNode = oldKeyed[newKey] || []\n\n      if (null == newKey) {\n        if (null == oldKey) {\n          patchElement(element, oldElement, oldChild, newChild, isSVG)\n          j++\n        }\n        i++\n      } else {\n        if (oldKey === newKey) {\n          patchElement(element, keyedNode[0], keyedNode[1], newChild, isSVG)\n          i++\n        } else if (keyedNode[0]) {\n          element.insertBefore(keyedNode[0], oldElement)\n          patchElement(element, keyedNode[0], keyedNode[1], newChild, isSVG)\n        } else {\n          patchElement(element, oldElement, null, newChild, isSVG)\n        }\n\n        j++\n        keyed[newKey] = newChild\n      }\n    }\n\n    while (i < oldLen) {\n      var oldChild = oldNode.children[i]\n      var oldKey = getKey(oldChild)\n      if (null == oldKey) {\n        removeElement(element, oldElements[i], oldChild.props)\n      }\n      i++\n    }\n\n    for (var i in oldKeyed) {\n      var keyedNode = oldKeyed[i]\n      var reusableNode = keyedNode[1]\n      if (!keyed[reusableNode.props.key]) {\n        removeElement(element, keyedNode[0], reusableNode.props)\n      }\n    }\n  } else if (element && node !== element.nodeValue) {\n    if (typeof node === \"string\" && typeof oldNode === \"string\") {\n      element.nodeValue = node\n    } else {\n      element = parent.insertBefore(\n        createElement(node, isSVG),\n        (nextSibling = element)\n      )\n      removeElement(parent, nextSibling, oldNode.props)\n    }\n  }\n  return element\n}\n","export default (main, onupdate) => {\n    var pending = false\n    const mapFunctionCollection = mapping => coll => {\n        if (typeof coll == 'function') return mapping(coll)\n        return Object.keys(coll).reduce((mapped, name) => {\n            mapped[name] = mapping(coll[name])\n            return mapped\n        }, {})\n    }\n    const store = _ => {\n        var state = {}\n        return {\n            set: diff => {\n                state = Object.assign({}, state, diff)\n                if (pending) return\n                pending = !pending\n                setTimeout(_ => {\n                    pending = !pending\n                    onupdate()\n                })\n            },\n            with: mapFunctionCollection(f => (...args) => f(state, ...args)),\n            sync: (f, ...args) => f(store(), ...args),\n        }\n    }\n    return main(store())\n}","var counter = 0\nexport default _ => 'zx' + (++counter)","import {h} from 'picodom'\nexport default str => {\n    return str\n    .replace(/\\s/g, '')\n    .split(',')\n    .reduce((tags, name) => {\n        tags[name] = (props, children) =>\n            (typeof props === 'object' && !Array.isArray(props))\n            ? h(name, props, children)\n            : h(name, {}, props)\n        return tags\n    }, {})\n}\n    ","import {h, patch} from 'picodom'\nimport state from './state'\nexport default fn => (...args) => {\n    const props = {}\n    props.oncreate = el => {\n        var node\n        el._zx = {}\n        el._zx.upd = _ => patch(node, (node = el._zx.bvf()), el)\n        el._zx.vfn = state(fn, el._zx.upd)\n        el._zx.bvf = _ => el._zx.vfn(...args)\n    }\n    props.onupdate = el => {\n        el._zx.bvf = _ => el._zx.vfn(...args)\n        el._zx.upd()\n    }\n    if (args[0] && args[0].key) props.key = args[0].key\n    return h('x-', props)    \n}","import {patch} from 'picodom'\nimport state from './state'\nexport default (fn, container) => {\n    var node\n    const view = state(fn, _ => patch(node, (node = view()), container))\n}"],"names":["h","type","props","node","children","i","arguments","length","stack","push","Array","isArray","pop","patch","oldNode","container","cb","element","patchElement","document","body","callbacks","merge","target","source","result","createElement","isSVG","createTextNode","createElementNS","oncreate","appendChild","setElementProp","name","value","oldValue","style","_","setAttribute","removeAttribute","removeElement","parent","remove","removeChild","onremove","getKey","key","nextSibling","insertBefore","oldProps","onupdate","updateElement","len","oldLen","oldKeyed","oldElements","keyed","oldElement","childNodes","oldKey","oldChild","j","newChild","newKey","keyedNode","reusableNode","nodeValue","main","pending","store","state","set","diff","Object","assign","setTimeout","with","mapping","coll","keys","reduce","mapped","mapFunctionCollection","f","args","sync","counter","str","replace","split","tags","fn","el","_zx","upd","bvf","vfn","view"],"mappings":"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"}